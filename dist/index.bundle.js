!function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=47)}([function(e,t){e.exports=require("mongoose")},function(e){e.exports={name:"server",version:"1.0.0",description:"MEN Full stack School Volunteer Dashboard using Node.js, Express, MongoDB",main:"index.js",scripts:{build:"webpack --progress",dev:"cross-env NODE_ENV=development nodemon src/index.js",start:"cross-env NODE_ENV=production nodemon src/index.js","start:bundle":"cross-env NODE_ENV=production node dist/index.bundle.js","heroku-postbuild":"webpack -p --progress",test:"cross-env NODE_ENV=test mocha",lint:"eslint",sass:"node-sass src/public/scss/styles.scss -o src/public/css"},repository:{type:"git",url:"https://github.com/enaselkhouly/school-volunteer-dashboard.git"},keywords:["node.js","express","mongo","mongodb","bootstrap","MEN stack"],author:"enaselkhouly",license:"MIT",config:{dbName:"men-dashboard"},dependencies:{bcrypt:"^2.0.1","bcrypt-nodejs":"0.0.3","connect-flash":"^0.1.1","connect-mongo":"^2.0.1",ejs:"^2.5.9",express:"^4.16.3","express-session":"^1.15.6",flatpickr:"^4.5.0","git-init":"^1.0.0",helmet:"^3.12.1","helmet-crossdomain":"^0.2.0",hoek:"^4.2.1","method-override":"^2.3.10",mongoose:"^5.0.16",nodemailer:"^4.6.6","nodemailer-html-to-text":"^2.1.0",nodemon:"^1.17.3",passport:"^0.4.0","passport-local":"^1.0.0","passport-local-mongoose":"^5.0.0","uuid-token-generator":"^1.0.0",webpack:"^4.14.0"},devDependencies:{"babel-core":"^6.26.3","babel-loader":"^7.1.4","babel-preset-env":"^1.7.0",bootstrap:"^4.1.1",chai:"^4.1.2","chai-http":"^4.0.0","cross-env":"^5.2.0","css-loader":"^1.0.0","ejs-html-loader":"^3.1.0",eslint:"^5.0.1","extract-text-webpack-plugin":"^4.0.0-beta.0",jquery:"^3.3.1","mini-css-extract-plugin":"^0.4.1",mocha:"^5.2.0",morgan:"^1.9.0","node-sass":"^4.9.0",popper:"^1.0.1","popper.js":"^1.14.3","postcss-loader":"^3.0.0","sass-loader":"^7.1.0",sinon:"^6.0.1","sinon-chai":"^3.2.0","style-loader":"^0.23.0",supertest:"^3.1.0","url-loader":"^1.1.1","webpack-cli":"^3.0.8","webpack-node-externals":"^1.7.2"}}},function(e,t){e.exports=require("async")},function(e,t){e.exports=require("bluebird")},function(e,t){e.exports=require("express")},function(e,t,s){"use strict";(function(t){let r=s(11),n=s(26),o=s(25);global.rootPath=r.normalize(r.join(t,"..")),e.exports={isDevelopmentMode:()=>!1,isProductionMode:()=>!0,isTestMode:()=>!1};let i=s(23),a={};e.exports.isTestMode()?(console.log("Load test config..."),a=s(22)):e.exports.isDevelopmentMode()?(console.log("Load development config..."),a=s(21)):e.exports.isProductionMode()&&(console.log("Load production config..."),a=s(20));let u={hashSecret:o(),sessionSecret:o()};e.exports=n.defaultsDeep(u,a,i,e.exports)}).call(this,"configs")},function(e,t,s){"use strict";"use-strict";var r=s(10),n=s(7);function o(e,t){var s=!0;return e.isAuthenticated()||(s=!1,e.flash("error","You need to be logged in!"),t.redirect("/login")),s}e.exports={isLoggedIn:function(e,t,s){if(o(e,t))return s()},isAdmin:function(e,t,s){if(o(e,t)){var r=e.user;r&&r.isAdmin()?s():(e.flash("error","You don't have permission!"),t.redirect("back"))}},isTeacher:function(e,t,s){if(o(e,t)){var r=e.user;r&&r.isTeacher()?s():(e.flash("error","You don't have permission!"),t.redirect("back"))}},isFamily:function(e,t,s){if(o(e,t)){var r=e.user;r&&r.isFamily()?s():(e.flash("error","You don't have permission!"),t.redirect("back"))}},isAdminOrTeacher:function(e,t,s){if(o(e,t)){var r=e.user;r&&(r.isAdmin()||r.isTeacher())?s():(e.flash("error","You don't have permission!"),t.redirect("back"))}},isAdminOrTaskOwner:function(e,t,s){o(e,t)&&n.findById(e.params.task_id,function(r,n){if(r)return e.flash("error",r.msg),void t.redirect("/projects");e.user&&(e.user.isAdmin()||n.author.id.equals(e.user._id))?s():(e.flash("error","You don't have permission!"),t.redirect("/projects"))})},isAdminOrProjectOwner:function(e,t,s){o(e,t)&&r.findById(e.params.id,function(r,n){if(r)return e.flash("error",r.msg),void t.redirect("/projects");e.user&&(e.user.isAdmin()||n.author.id.equals(e.user._id))?s():(e.flash("error","You don't have permission!"),t.redirect("/projects"))})},isTaskOwner:function(e,t,s){o(e,t)&&n.findById(e.params.task_id,function(r,n){if(r)return e.flash("error",r.msg),void t.redirect("/projects");n.author.id.equals(e.user._id)?s():(e.flash("error","You don't have permission!"),t.redirect("/projects"))})},isProjectOwner:function(e,t,s){o(e,t)&&r.findById(e.params.id,function(r,n){if(r)return e.flash("error",r.msg),void t.redirect("/projects");n.author.id.equals(e.user._id)?s():(e.flash("error","You don't have permission!"),t.redirect("/projects"))})}}},function(e,t,s){"use strict";"use-strict";var r=s(0);r.promise=s(3);var n={OPEN:"Open",INPROGRESS:"In-progress",PENDING:"Pending Approval",CLOSED:"Closed"},o="Uncategorized",i="At Home",a="In-campus",u="Outdoors",c=r.Schema({name:String,author:{id:{type:r.Schema.Types.ObjectId,ref:"User"},displayName:String},assignedTo:{id:{type:r.Schema.Types.ObjectId,ref:"User"},displayName:String},project:{id:{type:r.Schema.Types.ObjectId,ref:"Project"},name:String},description:String,status:{type:String,enum:[n.OPEN,n.INPROGRESS,n.PENDING,n.CLOSED],default:n.OPEN},category:{type:String,enum:[o,i,a,u],default:o},isFixedTime:{type:Boolean,default:!0},estimatedTime:{type:Number,default:30},volunteerTime:{type:Number,default:0},created:{type:Date,default:Date.now},deadline:{type:Date,default:Date.now},endTime:{type:Date}});c.methods.assignTask=function(e,t){var s=!1;return this.status===n.OPEN&&(this.assignedTo={id:e,displayName:t},this.status=n.ASSIGNED,this.save(),s=!0),s},c.methods.signUp=function(e,t){var s=!1;return this.status===n.OPEN&&(this.assignedTo={id:e,displayName:t},this.status=n.INPROGRESS,this.save(),s=!0),s},c.methods.cancelTask=function(){var e=!1;return this.status===n.INPROGRESS&&(this.assignedTo.id=null,this.assignedTo.displayName="",this.status=n.OPEN,this.save(),e=!0),e},c.methods.completeTask=function(e){var t=!1;return this.status===n.INPROGRESS&&this.assignedTo&&this.assignedTo.id&&this.assignedTo.id.toString()==e.toString()&&(this.status=n.PENDING,this.save(),t=!0),t},c.methods.approveTask=function(){var e=!1;return this.status===n.PENDING&&(this.status=n.CLOSED,this.save(),e=!0),e},c.methods.unapproveTask=function(){var e=!1;return this.status===n.PENDING&&(this.status=n.INPROGRESS,this.save(),e=!0),e},e.exports=r.model("Task",c)},function(e,t,s){"use strict";"use-strict";var r=s(0),n=s(34),o=s(33);r.promise=s(3);var i="Admin",a="Teacher",u="Family",c=new r.Schema({displayName:{type:String,required:!0},username:{type:String,unique:!0,required:!0},email:{type:String,unique:!0,required:!0},userType:{type:String,enum:[i,a,u],required:!0},requiredVolunteerTime:{type:Number,default:900},projects:[{type:r.Schema.Types.ObjectId,ref:"Project"}],tasks:[{type:r.Schema.Types.ObjectId,ref:"Task"}],created:{type:Date,default:Date.now},password:String,resetPasswordToken:String,resetPasswordExpires:Date});c.methods.isAdmin=function(){var e=!1;return this.userType===i&&(e=!0),e},c.methods.isTeacher=function(){var e=!1;return this.userType===a&&(e=!0),e},c.methods.isFamily=function(){var e=!1;return this.userType===u&&(e=!0),e},c.plugin(o),c.methods.comparePassword=function(e,t){n.compare(e,this.password,function(e,s){t(e,s)})},e.exports=r.model("User",c)},function(e,t,s){"use strict";"user-strict";var r=s(8),n=s(10),o=s(7),i=s(2);function a(e,t,s){r.findById(e,function(e,r){!e&&r&&(r.projects.pull({_id:t}),r.save()),s(e)})}e.exports={allUsers:function(e){r.find({},function(t,s){e(t,s)})},getUserTasks:function(e,t,s){"All"!=t?r.findById(e._id).populate({path:"tasks",match:{status:t}}).exec(function(e,t){s(e,t.tasks,void 0)}):r.findById(e._id).populate({path:"tasks"}).exec(function(e,t){s(e,t.tasks,void 0)})},getUserProjects:function(e,t,s,n){var o={path:"projects",populate:{path:"tasks",model:"Task",match:{$or:[{"assignedTo.id":e._id},{"author.id":e._id}],category:{$in:s},status:{$in:t}}}};r.findById(e._id).populate(o).exec(function(e,t){n(e,t.projects)})},addProjectToUser:function(e,t,s){var n={_id:e,"projects.id":{$ne:t}},o={$addToSet:{projects:{_id:t}}};r.findOneAndUpdate(n,o,function(e,t){s(e,t)})},removeProjectFromUser:a,allProjects:function(e,t,s,r){var o={path:"tasks",model:"Task",match:{category:{$in:s},status:{$in:t}}};n.find().populate(o).exec(function(e,t){r(e,t)})},getProject:function(e,t){n.findById(e).populate({path:"tasks"}).exec(function(e,s){t(e,s)})},createProject:function(e,t){n.create(e,function(e,s){t(e,s)})},addTaskToProject:function(e,t,s){n.findByIdAndUpdate(e,{$push:{tasks:t}},function(e,t){s(e,t)})},removeTaskFromProject:function(e,t,s,r){i.waterfall([function(s){var r={path:"tasks",model:"Task",match:{$or:[{"assignedTo.id":e},{"author.id":e}]}};n.findById(t).populate(r).exec(function(e,t){e?s(e):s(null,t)})},function(e,r){var o=null,i=null;e.tasks&&1==e.tasks.length&&(o=e.tasks[0].author.id,i=e.tasks[0].assignedTo.id),n.findByIdAndUpdate(t,{$pull:{tasks:s}},function(e,t){e?r(e):r(null,t,o,i)})},function(s,r,n,o){!s.author.id.equals(e)&&r&&a(r,t,function(e){e&&o(e)}),n&&a(n,t,function(e){e&&o(e)}),o(null)}],function(e){r(e)})},removeAllProjectTasks:function(e,t){var s={_id:e.tasks};o.remove(s,function(e){t(e)})},deleteProject:function(e,t){e.remove(function(e){t(e)})},addTaskToUser:function(e,t,s){var n={_id:e,"tasks.id":{$ne:t}},o={$addToSet:{tasks:{_id:t}}};r.findOneAndUpdate(n,o,function(e,t){s(e,t)})},removeTaskFromUser:function(e,t,s){var n={$pull:{tasks:t}};r.findByIdAndUpdate(e,n,function(e,t){s(e,t)})},allTasks:function(e,t){"All"!=e?o.find({status:e},function(e,s){t(e,s)}):o.find(function(e,s){t(e,s)})},getTask:function(e,t){o.findById(e,function(e,s){t(e,s)})},createTask:function(e,t){o.create(e,function(e,s){t(e,s)})},deleteTask:function(e,t){e.remove(function(e){t(e)})},getVolunteerTime:function(e,t){o.aggregate([{$match:{status:"Closed","assignedTo.id":e._id}},{$group:{_id:0,total:{$sum:"$volunteerTime"}}}],function(e,s){var r=0;return e||s.length>0&&(r=s[0].total),t(e,r)})},statusQuery:function(e){var t=["Open","In-progress","Pending Approval","Closed"],s=[];if(e)for(var r=0;r<t.length;r++){var n=t[r].toLowerCase();n=n.replace(/ /g,""),e.indexOf(""+n)>-1&&s.push(t[r])}else s=t;return s},categoryQuery:function(e){var t=["Uncategorized","At Home","In-campus","Outdoors"],s=[];if(e)for(var r=0;r<t.length;r++){var n=t[r].toLowerCase();n=n.replace(/ /g,""),e.indexOf(""+n)>-1&&s.push(t[r])}else s=t;return s}}},function(e,t,s){"use strict";"use-strict";var r=s(0);r.promise=s(3);var n=r.Schema({name:String,author:{id:{type:r.Schema.Types.ObjectId,ref:"User"},displayName:String},description:String,tasks:[{type:r.Schema.Types.ObjectId,ref:"Task"}],assignedTo:[{type:r.Schema.Types.ObjectId,ref:"User"}],created:{type:Date,default:Date.now}});e.exports=r.model("Project",n)},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("passport")},,function(e,t,s){},function(e,t,s){"use strict";const r=s(0);e.exports={connect:function(e){r.Promise=s(3);const t=process.env.DATABASEURL||e.db.url;r.connect(t),console.log("Database is connected on: ",t)}}},function(e,t){e.exports=require("passport-local")},function(e,t,s){"use strict";const r=s(12),n=s(16),o=s(8);e.exports.init=function(e,t){t.use(r.initialize()),t.use(r.session()),r.use(new n(o.authenticate())),r.serializeUser(o.serializeUser()),r.deserializeUser(o.deserializeUser())}},function(e,t){e.exports=require("nodemailer-html-to-text")},function(e,t){e.exports=require("nodemailer")},function(e,t,s){"use strict";let r=s(1);e.exports={app:{title:r.name+" [Development mode]"},sessions:{cookie:{secure:!0}},db:{url:process.env.MONGO_URI||"mongodb://localhost/"+r.config.dbName+"-production"}}},function(e,t,s){"use strict";let r=s(1);e.exports={app:{title:r.name+" [Development mode]"},db:{url:process.env.MONGO_URI||"mongodb://localhost/"+r.config.dbName+"-dev",options:{user:"",pass:"",server:{socketOptions:{keepAlive:1}}}},mailer:{enabled:"true",from:"School Dashboard <sender@example.com>",transporter:"smtp",smtp:{host:"smtp.ethereal.email",port:587,secure:!1,auth:{user:"hllmmt4fhdlbwkwk@ethereal.email",pass:"8s2txRyFJZDEux5grW"}}}}},function(e,t,s){"use strict";let r=s(1);e.exports={app:{title:r.name+" [Test mode]"},hashSecret:"71IIYMzMb0egTaCvvdijhUajAOjsrurzyRX5ziskMk4",sessionSecret:"MB9x-hOkx-UdcCbOprxggu-Wv1PetuoqzBny1h8DULA",test:!0,db:{url:"mongodb://localhost/"+r.config.dbName+"-test",options:{user:"",pass:""}},mailer:{enabled:"true",from:"School Dashboard <sender@example.com>",transporter:"smtp",smtp:{host:"smtp.ethereal.email",port:587,secure:!1,auth:{user:"hllmmt4fhdlbwkwk@ethereal.email",pass:"8s2txRyFJZDEux5grW"}}}}},function(e,t,s){"use strict";let r=s(11),n=s(1);e.exports={app:{title:n.title,version:n.version,description:n.description,url:"http://localhost:"+(process.env.PORT||3e3)+"/",contactEmail:""},sessions:{cookie:{maxAge:72e5,httpOnly:!0,secure:!1},name:"sessionId",collection:"sessions"},ip:process.env.NODE_IP||"0.0.0.0",port:process.env.PORT||3e3,hostname:process.env.PORT||"localhost",rootPath:global.rootPath,dataFolder:r.join(global.rootPath,"data"),viewEngine:"ejs",test:!1,features:{}}},function(e,t){e.exports=require("uuid-token-generator")},function(e,t,s){"use strict";let r=s(24),n=new r(256,r.BASE62);e.exports=function(){return n.generate()}},function(e,t){e.exports=require("lodash")},function(e,t,s){"use strict";"use-strict";var r=s(5),n=s(19),o=s(18).htmlToText;e.exports={init:function(e){n.createTestAccount(function(t,s){return t?(console.error("Failed to create a testing account. "+t.message),process.exit(1)):(console.log("Email credentials obtained ..."),e(t,s))})},send:function(e,t,s,i){var a={from:r.mailer.from,to:e,subject:t,html:s},u=n.createTransport(r.mailer.smtp);if(!u)return i(new Error("Unable to send email! Invalid mailer transport"),null);u.verify(function(e,t){if(e)return console.log("Error verify",e),i(e,null);console.log("success verify"),u.use("compile",o()),u.sendMail(a,function(e,t){return e?(console.log(e),i(e,null)):(console.log(t),i(null,t))})})}}},function(e,t){e.exports=require("crypto")},function(e,t,s){"use strict";var r=s(8),n=s(12),o=s(9),i=s(2),a=s(28),u=s(27),c=s(5);e.exports={getRegister:function(e,t){var s=e.user.userType.toLowerCase();t.render("user/"+s,{title:"Register",currentUser:e.user,page:"register"})},postRegister:function(e,t){var s=new r(e.body.user);s.requiredVolunteerTime*=60,r.register(s,e.body.password,function(s){if(s)return e.flash("error",s.message),void t.redirect("/register");t.redirect("/users")})},getLogin:function(e,t){t.render("user/login",{title:"Login"})},postLogin:function(e,t,s){n.authenticate("local",function(r,n){return r?s(r):n?void e.logIn(n,function(e){return e?s(e):t.redirect("/users/"+n._id)}):(e.flash("error","No user with those credentials is found!"),t.redirect("/login"))})(e,t,s)},getLogout:function(e,t){e.logout(),e.flash("success","Successfuly logged out!"),t.redirect("/")},getForgot:function(e,t){t.render("user/forgot",{title:"forgot"})},postForgot:function(e,t){i.waterfall([function(e){a.randomBytes(20,function(t,s){if(t)return e(t);var r=s.toString("hex");e(null,r)})},function(t,s){r.findOne({email:e.body.email},function(e,r){if(!r)return s(new Error("No account with that email address exists."));r.resetPasswordToken=t,r.resetPasswordExpires=Date.now()+36e5,r.save(function(e){if(e)return s(e);s(null,t,r)})})},function(s,r,n){var o="✔ Reset your password on "+c.app.title;t.render("mail/passwordReset",{name:r.fullName,resetLink:"http://"+e.headers.host+"/reset/"+s},function(e,t){if(e)return n(e);u.send(r.email,o,t,function(e){n(e||null)})})}],function(s){s?(e.flash("error",s.message),t.redirect("/forgot")):(e.flash("success","An email has been sent to you with further instructions."),t.redirect("/login"))})},getReset:function(e,t){r.findById(e.params.id,function(s,r){s||!r?(e.flash("error","User not found!"),t.redirect("back")):t.render("user/admin",{title:"reset",page:"reset",user:r})})},postReset:function(e,t){i.waterfall([function(t){if(!e.user.isAdmin())return t(new Error("Invalid credentials, you must be admin to request a reset"));e.user.authenticate(e.body.password,function(e,s){return t(e||(!1===s?new Error("Wrong Admin password!"):null))})},function(t){r.findById(e.params.id,function(e,s){return e?t(e):t(null,s)})},function(t,s){t.setPassword(e.body.newPassword,function(e){return e?s(e):(t.save(),s(null))})}],function(s){s?(e.flash("error",s.message),t.redirect("back")):(e.flash("success","Password is successfully reset!"),t.redirect("/users/"+e.params.id))})},getUsers:function(e,t){var s=e.user;o.allUsers(function(r,n){if(r)e.flash("error",r.message),t.redirect("/");else{var o=s.userType.toLowerCase();t.render("user/"+o,{users:n,currentUser:s,page:"index"})}})},getUser:function(e,t){var s=o.statusQuery(e.query.status),r=o.categoryQuery(e.query.category);o.getUserProjects(e.user,s,r,function(n,o){if(n)e.flash("error",n.message),t.redirect("/");else{var i=e.user.userType.toLowerCase();t.render("user/"+i,{user:e.user,projects:o,status:s,category:r,page:"show"})}})},getUserProfile:function(e,t){var s=e.user.userType.toLowerCase();i.waterfall([function(t){r.findById(e.params.id,function(e,s){if(e)return t(e);t(null,s)})},function(e,t){o.getVolunteerTime(e,function(s,r){if(s)return t(s);t(null,e,r)})}],function(r,n,o){r?(e.flash("error",r.message),t.redirect("/users/"+e.params.id)):t.render("user/"+s,{user:n,volunteerTime:o,title:"Profile",page:"profile"})})},getEditUser:function(e,t){var s=e.user.userType.toLowerCase();r.findById(e.params.id,function(r,n){r?(e.flash("error",r.message),t.redirect("/users")):t.render("user/"+s,{title:"Edit User",user:n,page:"edit"})})},putUser:function(e,t){var s=e.body.user;s.requiredVolunteerTime*=60,r.findByIdAndUpdate(e.params.id,s,function(s){s?e.flash("error",s.message):e.flash("success","User is edited successfully!"),t.redirect("/users")})},deleteUser:function(e,t){if(e.user._id.equals(e.params.id)){var s=new Error("You can not delete your own account!");e.flash("error",s.message),t.redirect("/users")}else r.findByIdAndRemove(e.params.id,function(s){s?(e.flash("error",s.message),t.redirect("/users")):(e.flash("success","Successfully deleted the User!"),t.redirect("/users"))})}}},function(e,t,s){"use strict";"use-strict";var r=s(29),n=s(6),o=s(4).Router();o.get("/register",n.isAdmin,r.getRegister),o.post("/register",n.isAdmin,r.postRegister),o.get("/login",r.getLogin),o.post("/login",r.postLogin),o.get("/logout",n.isLoggedIn,r.getLogout),o.get("/forgot",r.getForgot),o.post("/forgot",r.postForgot),o.get("/users/:id/reset",n.isAdmin,r.getReset),o.post("/users/:id/reset",n.isAdmin,r.postReset),o.get("/users",n.isAdmin,r.getUsers),o.get("/users/:id",n.isLoggedIn,r.getUser),o.get("/users/:id/profile",n.isLoggedIn,r.getUserProfile),o.get("/users/:id/edit",n.isAdmin,r.getEditUser),o.put("/users/:id",n.isAdmin,r.putUser),o.delete("/users/:id",n.isAdmin,r.deleteUser),e.exports=o},function(e,t,s){"use strict";var r=s(7),n=s(9),o=s(2);e.exports={getTasks:function(e,t){return t.redirect("/projects/"+e.params.id)},getTask:function(e,t){var s=e.user,r=e.user.userType.toLowerCase();n.getTask(e.params.task_id,function(n,o){if(n)return e.flash("error",n.message),t.redirect("back");t.render("user/"+r,{user:s,task:o,page:"task/show"})})},getNewTask:function(e,t){var s=e.user.userType.toLowerCase(),r=e.params.id;t.render("user/"+s,{projectId:r,page:"task/new"})},postNewTask:function(e,t){o.waterfall([function(t){var s=new r(e.body.task);if(s.author={id:e.user._id,displayName:e.user.displayName},e.body.task.estimatedTime=e.body.task.volunteerTime,!s.deadline)return t(new Error("Task deadline/date could not be left empty."));var o="";if(e.body.startTime&&((o=e.body.startTime.split(":"))[0]&&s.deadline.setHours(o[0].trim()),o[1]&&s.deadline.setMinutes(o[1].trim())),e.body.endTime){var i=e.body.endTime;s.endTime=new Date(s.deadline.getTime());var a=i.split(":");a[0]&&s.endTime.setHours(a[0].trim()),a[1]&&s.endTime.setMinutes(a[1].trim())}n.getProject(e.params.id,function(e,r){if(e)return t(e);s.project={id:r._id,name:r.name},t(null,s)})},function(e,t){n.createTask(e,t)},function(e,t){n.addTaskToProject(e.project.id,e._id,function(s,r){if(s)return t(s);t(null,e,r)})},function(t,s,r){n.addTaskToUser(e.user._id,t._id,function(e){if(e)return r(e);r(null,t,s)})},function(t,s,r){n.addProjectToUser(e.user._id,s._id,function(e){if(e)return r(e);r(null)})}],function(s){s?(e.flash("error",s.message),t.redirect("/users/"+e.user._id)):(e.flash("success","The task is created successfully!"),t.redirect("/users/"+e.user._id))})},getEditTask:function(e,t){var s=e.user.userType.toLowerCase();r.findById(e.params.task_id,function(r,n){r?(e.flash("error",r.message),t.redirect("/users/"+e.user._id)):t.render("user/"+s,{task:n,page:"task/edit"})})},putTask:function(e,t){o.waterfall([function(t){if(e.query.Approve||e.query.Complete||(e.body.task.estimatedTime=e.body.task.volunteerTime),e.body.endTime){e.body.task.endTime=new Date(e.body.task.deadline);var s=e.body.endTime.split(":");s[0]&&e.body.task.endTime.setHours(s[0].trim()),s[1]&&e.body.task.endTime.setMinutes(s[1].trim())}r.findByIdAndUpdate(e.params.task_id,e.body.task,function(e,s){if(e)return t(e);t(null,s,"Task is successfully edited!")})},function(t,s,r){if(e.query.Approve){if(!t.approveTask())return r(new Error("The task could not be approved!"));s="The task is successfully approved!"}r(null,t,s)},function(t,s,r){if(e.query.Complete){if(!t.completeTask(e.user._id))return r(new Error("The task could not be changed to completed!"));s="The task is successfully completed!"}r(null,s)}],function(s,r){s?e.flash("error",s.message):e.flash("success",r),t.redirect("/users/"+e.user._id)})},signupTask:function(e,t){o.waterfall([function(t){r.findById(e.params.task_id,function(e,s){if(e)return t(e);t(null,s)})},function(t,s){n.addTaskToUser(e.user._id,t._id,function(e,r){return e?s(e):t.signUp(r._id,r.displayName)?void s(null,t):s(new Error("You can not sign up for this task!"))})},function(t,s){n.addProjectToUser(e.user.id,t.project.id,function(e){if(e)return s(e);s(null)})}],function(s){s?(e.flash("error",s.message),t.redirect("back")):(e.flash("success","You are successfully signed up for the task!"),t.redirect("back"))})},cancelTask:function(e,t){o.waterfall([function(t){n.removeTaskFromUser(e.user._id,e.params.task_id,function(e){if(e)return t(e);t(null)})},function(t){r.findById(e.params.task_id,function(e,s){if(e)return t(e);s.cancelTask(),t(null)})}],function(s){s?(e.flash("error",s.message),t.redirect("back")):(e.flash("success","The Task assign is successfully cancelled!"),t.redirect("back"))})},completeTask:function(e,t){r.findById(e.params.task_id,function(s,r){if(s)return e.flash("error",s.message),t.redirect("back");r.completeTask(e.user._id)?(e.flash("success","The Task status is changed to completed!"),t.redirect("back")):(e.flash("error","The task status could not be changed to completed!"),t.redirect("back"))})},approveTask:function(e,t){r.findById(e.params.task_id,function(s,r){if(s)return e.flash("error",s.message),t.redirect("back");r.approveTask()?(e.flash("success","The task is approved!"),t.redirect("back")):(e.flash("error","The task could not be approved!"),t.redirect("back"))})},postApproveTask:function(e,t){t.redirect("back")},unapproveTask:function(e,t){r.findById(e.params.task_id,function(s,r){if(s)return e.flash("error",s.message),t.redirect("back");r.unapproveTask()?(e.flash("success","The task is unapproved!"),t.redirect("back")):(e.flash("error","The task could not be unapproved!"),t.redirect("back"))})},deleteTask:function(e,t){o.waterfall([function(t){r.findById(e.params.task_id,function(e,s){if(e)return t(e);t(null,s)})},function(e,t){e&&e.author&&n.removeTaskFromUser(e.author.id,e._id,function(s){if(s)return t(s);t(null,e)})},function(e,t){e&&e.assignedTo&&n.removeTaskFromUser(e.assignedTo.id,e._id,function(s){if(s)return t(s);t(null,e)})},function(t,s){t.project&&n.removeTaskFromProject(e.user._id,t.project.id,t._id,function(e){if(e)return s(e);s(null,t)})},function(e,t){e.remove(e._id,function(s){if(s)return t(s);t(null,e)})}],function(s){s?(e.flash("error",s.message),t.redirect("/projects")):(e.flash("success","The task is successfully deleted!"),t.redirect("/projects"))})}}},function(e,t,s){"use strict";"use-strict";var r=s(31),n=s(6),o=s(4).Router();o.get("/projects/:id/tasks",n.isLoggedIn,r.getTasks),o.get("/projects/:id/tasks/new",n.isProjectOwner,r.getNewTask),o.get("/projects/:id/tasks/:task_id",n.isLoggedIn,r.getTask),o.post("/projects/:id/tasks",n.isProjectOwner,r.postNewTask),o.get("/projects/:id/tasks/:task_id/edit",n.isTaskOwner,r.getEditTask),o.put("/projects/:id/tasks/:task_id",n.isLoggedIn,r.putTask),o.get("/projects/:id/tasks/:task_id/signup",n.isFamily,r.signupTask),o.get("/projects/:id/tasks/:task_id/cancel",n.isFamily,r.cancelTask),o.get("/projects/:id/tasks/:task_id/unapprove",n.isTaskOwner,r.unapproveTask),o.delete("/projects/:id/tasks/:task_id",n.isTaskOwner,r.deleteTask),e.exports=o},function(e,t){e.exports=require("passport-local-mongoose")},function(e,t){e.exports=require("bcrypt")},function(e,t,s){"use strict";var r=s(10),n=s(9),o=s(2);e.exports={getProjects:function(e,t){var s=e.user,r=e.user.userType.toLowerCase(),o=n.statusQuery(e.query.status),i=n.categoryQuery(e.query.category);e.user.isFamily()&&(o="Open"),n.allProjects(e.user,o,i,function(n,a){n?(e.flash("error",n.message),t.redirect("/")):t.render("user/"+r,{user:s,projects:a,status:o,category:i,page:"project/index"})})},getProject:function(e,t){var s=e.user,r=e.user.userType.toLowerCase();n.getProject(e.params.id,function(n,o){n?(e.flash("error",n.message),t.redirect("back")):t.render("user/"+r,{user:s,project:o,page:"project/show"})})},getNewProject:function(e,t){var s=e.user.userType.toLowerCase();t.render("user/"+s,{page:"project/new"})},postNewProject:function(e,t){var s=new r(e.body.project);s.author={id:e.user._id,displayName:e.user.displayName},o.waterfall([function(e){n.createProject(s,function(t,s){return t?e(t):e(null,s)})},function(t,s){n.addProjectToUser(e.user,t._id,function(e){return s(e||null)})}],function(s){if(s)return e.flash("error",s.message),t.redirect("/projects/new");e.flash("success","Successfully created a new Project!"),t.redirect("/users/"+e.user._id)})},getEditProject:function(e,t){var s=e.user.userType.toLowerCase();r.findById(e.params.id,function(r,n){r?(e.flash("error",r.message),t.redirect("back")):t.render("user/"+s,{project:n,page:"project/edit"})})},putProject:function(e,t){r.findByIdAndUpdate(e.params.id,e.body.project,function(s){s?e.flash("error",s.message):e.flash("success","The project is successfully edited!"),t.redirect("/users/"+e.user._id)})},deleteProject:function(e,t){o.waterfall([function(t){r.findById(e.params.id,function(e,s){return e?t(e):t(null,s)})},function(e,t){n.removeProjectFromUser(e.author.id,e._id,function(s){return s?t(s):t(null,e)})},function(e,t){n.removeAllProjectTasks(e,function(s){return s?t(s):t(null,e)})},function(e,t){e.remove(e._id,function(e){return t(e||null)})}],function(s){s?(e.flash("error",s.message),t.redirect("/users/"+e.user._id)):(e.flash("success","Successfully deleted the Project!"),t.redirect("/users/"+e.user._id))})}}},function(e,t,s){"use strict";"use-strict";var r=s(35),n=s(6),o=s(4).Router();o.get("/projects",n.isLoggedIn,r.getProjects),o.get("/projects/new",n.isAdminOrTeacher,r.getNewProject),o.get("/projects/:id",n.isLoggedIn,r.getProject),o.post("/projects",n.isAdminOrTeacher,r.postNewProject),o.get("/projects/:id/edit",n.isProjectOwner,r.getEditProject),o.put("/projects/:id",n.isProjectOwner,r.putProject),o.delete("/projects/:id",n.isProjectOwner,r.deleteProject),e.exports=o},function(e,t,s){"use strict";e.exports={init:function(e){var t=s(36),r=s(32),n=s(30);e.use("",t),e.use("",r),e.use("",n),e.get("/",function(e,t){t.redirect("/login")}),e.get("*",function(e,t){t.send("Page could not be found!")})}}},function(e,t){e.exports=require("connect-mongo")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("helmet-crossdomain")},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("method-override")},function(e,t){e.exports=require("connect-flash")},function(e,t){e.exports=require("body-parser")},function(e,t,s){"use strict";const r=s(4),n=s(44),o=s(43),i=s(42),a=s(11),u=s(41),c=s(40),d=s(39),l=s(0),f=s(38)(d);e.exports=function(){let e,t,p=r();return{create:e=function(e){let t=s(37),m=s(17);p.set("env",e.env),p.set("port",e.port),p.set("hostname",e.hostname),p.use(n.json()),p.use(n.urlencoded({extended:"false"})),p.use(i("_method"));let g=a.normalize(a.join(e.rootPath,"src"));p.set("views",a.join(g,"views")),p.use(r.static(a.join(g,"public"))),p.set("view engine",e.viewEngine),p.use(o()),p.use(u.xssFilter({setOnOldIE:!0})),p.use(u.noSniff()),p.use(u.frameguard()),p.use(u.ieNoOpen()),p.use(c()),p.use(u.hidePoweredBy()),p.set("trust proxy",1),p.use(d({saveUninitialized:!0,resave:!1,secret:e.sessionSecret,store:new f({mongooseConnection:l.connection,collection:e.sessions.collection,autoReconnect:!0}),cookie:e.sessions.cookie,name:e.sessions.name})),m.init(e,p),p.use(function(e,t,s){t.locals.currentUser=e.user,t.locals.error=e.flash("error"),t.locals.success=e.flash("success"),s()}),t.init(p)},start:t=function(){let e=p.get("hostname"),t=process.env.PORT||p.get("port");p.listen(t,function(){console.log("Express server listening on - http://"+e+":"+t)})},server:p}}},function(e,t,s){"use strict";var r=s(45)(),n=s(15),o=s(5);n.connect(o),r.create(o),r.start(),e.exports=r},function(e,t,s){s(46),e.exports=s(14)}]);