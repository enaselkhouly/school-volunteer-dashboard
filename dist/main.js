!function(e){var t={};function r(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(s,o,function(t){return e[t]}.bind(null,o));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=41)}([function(e,t){e.exports=require("mongoose")},function(e){e.exports={name:"server",version:"1.0.0",description:"MEN Full stack School Volunteer Dashboard using Node.js, Express, MongoDB",main:"index.js",scripts:{build:"webpack --progress",dev:"cross-env NODE_ENV=development nodemon src/index.js",start:"cross-env NODE_ENV=production nodemon src/index.js","start:bundle":"cross-env NODE_ENV=production node dist/main.js","heroku-postbuild":"webpack -p --config ./webpack.prod.config.js --progress",test:"cross-env NODE_ENV=test mocha",lint:"eslint",sass:"node-sass src/public/scss/styles.scss -o src/public/css"},repository:{type:"git",url:"https://github.com/enaselkhouly/school-volunteer-dashboard.git"},keywords:["node.js","express","mongo","mongodb","bootstrap","MEN stack"],author:"enaselkhouly",license:"MIT",config:{dbName:"men-dashboard"},dependencies:{"bcrypt-nodejs":"0.0.3","connect-flash":"^0.1.1","connect-mongo":"^2.0.1",ejs:"^2.5.9",express:"^4.16.3","express-session":"^1.15.6",flatpickr:"^4.5.0","git-init":"^1.0.0",hoek:"^4.2.1","method-override":"^2.3.10",mongoose:"^5.0.16",nodemailer:"^4.6.6","nodemailer-html-to-text":"^2.1.0",nodemon:"^1.17.3",passport:"^0.4.0","passport-local":"^1.0.0","passport-local-mongoose":"^5.0.0","uuid-token-generator":"^1.0.0"},devDependencies:{"babel-core":"^6.26.3","babel-loader":"^7.1.4","babel-preset-env":"^1.7.0",bootstrap:"^4.1.1",chai:"^4.1.2","chai-http":"^4.0.0","cross-env":"^5.2.0",eslint:"^5.0.1",jquery:"^3.3.1",mocha:"^5.2.0",morgan:"^1.9.0","node-sass":"^4.9.0",popper:"^1.0.1","popper.js":"^1.14.3",sinon:"^6.0.1","sinon-chai":"^3.2.0",supertest:"^3.1.0",webpack:"^4.14.0","webpack-cli":"^3.0.8","webpack-node-externals":"^1.7.2"}}},function(e,t){e.exports=require("async")},function(e,t){e.exports=require("bluebird")},function(e,t){e.exports=require("express")},function(e,t,r){"use strict";(function(t){let s=r(11),o=r(24),n=r(23);global.rootPath=s.normalize(s.join(t,"..")),e.exports={isDevelopmentMode:()=>!1,isProductionMode:()=>!0,isTestMode:()=>!1};let i=r(21),a={};e.exports.isTestMode()?(console.log("Load test config..."),a=r(20)):e.exports.isDevelopmentMode()?(console.log("Load development config..."),a=r(19)):e.exports.isProductionMode()&&(console.log("Load production config..."),a=r(18));let u={hashSecret:n(),sessionSecret:n()};e.exports=o.defaultsDeep(u,a,i,e.exports)}).call(this,"/")},function(e,t,r){"use strict";"use-strict";var s=r(7),o=r(10);function n(e,t){var r=!0;return e.isAuthenticated()||(r=!1,e.flash("error","You need to be logged in!"),t.redirect("/login")),r}e.exports={isLoggedIn:function(e,t,r){if(n(e,t))return r()},isAdmin:function(e,t,r){if(n(e,t)){var s=e.user;s&&s.isAdmin()?r():(e.flash("error","You don't have permission!"),t.redirect("back"))}},isTeacher:function(e,t,r){if(n(e,t)){var s=e.user;s&&s.isTeacher()?r():(e.flash("error","You don't have permission!"),t.redirect("back"))}},isFamily:function(e,t,r){if(n(e,t)){var s=e.user;s&&s.isFamily()?r():(e.flash("error","You don't have permission!"),t.redirect("back"))}},isAdminOrTeacher:function(e,t,r){if(n(e,t)){var s=e.user;s&&(s.isAdmin()||s.isTeacher())?r():(e.flash("error","You don't have permission!"),t.redirect("back"))}},isAdminOrTaskOwner:function(e,t,r){n(e,t)&&o.findById(e.params.task_id,function(s,o){if(s)return e.flash("error",s.msg),void t.redirect("/projects");e.user&&(e.user.isAdmin()||o.author.id.equals(e.user._id))?r():(e.flash("error","You don't have permission!"),t.redirect("/projects"))})},isAdminOrProjectOwner:function(e,t,r){n(e,t)&&s.findById(e.params.id,function(s,o){if(s)return e.flash("error",s.msg),void t.redirect("/projects");e.user&&(e.user.isAdmin()||o.author.id.equals(e.user._id))?r():(e.flash("error","You don't have permission!"),t.redirect("/projects"))})},isTaskOwner:function(e,t,r){n(e,t)&&o.findById(e.params.task_id,function(s,o){if(s)return e.flash("error",s.msg),void t.redirect("/projects");o.author.id.equals(e.user._id)?r():(e.flash("error","You don't have permission!"),t.redirect("/projects"))})},isProjectOwner:function(e,t,r){n(e,t)&&s.findById(e.params.id,function(s,o){if(s)return e.flash("error",s.msg),void t.redirect("/projects");o.author.id.equals(e.user._id)?r():(e.flash("error","You don't have permission!"),t.redirect("/projects"))})}}},function(e,t,r){"use strict";"use-strict";var s=r(0);s.promise=r(3);var o=s.Schema({name:String,author:{id:{type:s.Schema.Types.ObjectId,ref:"User"},displayName:String},description:String,tasks:[{type:s.Schema.Types.ObjectId,ref:"Task"}],assignedTo:[{type:s.Schema.Types.ObjectId,ref:"User"}],created:{type:Date,default:Date.now}});e.exports=s.model("Project",o)},function(e,t,r){"use strict";"use-strict";var s=r(0),o=r(31);s.promise=r(3);var n="Admin",i="Teacher",a="Family",u=new s.Schema({displayName:{type:String,required:!0},username:{type:String,unique:!0,required:!0},email:{type:String,unique:!0,required:!0},userType:{type:String,enum:[n,i,a],required:!0},requiredVolunteerTime:{type:Number,default:900},projects:[{type:s.Schema.Types.ObjectId,ref:"Project"}],tasks:[{type:s.Schema.Types.ObjectId,ref:"Task"}],created:{type:Date,default:Date.now},password:String,resetPasswordToken:String,resetPasswordExpires:Date});u.methods.isAdmin=function(){var e=!1;return this.userType===n&&(e=!0),e},u.methods.isTeacher=function(){var e=!1;return this.userType===i&&(e=!0),e},u.methods.isFamily=function(){var e=!1;return this.userType===a&&(e=!0),e},u.plugin(o),e.exports=s.model("User",u)},function(e,t,r){"use strict";"user-strict";var s=r(8),o=r(7),n=r(10),i=r(2);function a(e,t,r){s.findById(e,function(e,s){!e&&s&&(s.projects.pull({_id:t}),s.save()),r(e)})}e.exports={allUsers:function(e){s.find({},function(t,r){e(t,r)})},getUserTasks:function(e,t,r){"All"!=t?s.findById(e._id).populate({path:"tasks",match:{status:t}}).exec(function(e,t){r(e,t.tasks,void 0)}):s.findById(e._id).populate({path:"tasks"}).exec(function(e,t){r(e,t.tasks,void 0)})},getUserProjects:function(e,t,r,o){var n={path:"projects",populate:{path:"tasks",model:"Task",match:{$or:[{"assignedTo.id":e._id},{"author.id":e._id}],category:{$in:r},status:{$in:t}}}};s.findById(e._id).populate(n).exec(function(e,t){o(e,t.projects)})},addProjectToUser:function(e,t,r){var o={_id:e,"projects.id":{$ne:t}},n={$addToSet:{projects:{_id:t}}};s.findOneAndUpdate(o,n,function(e,t){r(e,t)})},removeProjectFromUser:a,allProjects:function(e,t,r,s){var n={path:"tasks",model:"Task",match:{category:{$in:r},status:{$in:t}}};o.find().populate(n).exec(function(e,t){s(e,t)})},getProject:function(e,t){o.findById(e).populate({path:"tasks"}).exec(function(e,r){t(e,r)})},createProject:function(e,t){o.create(e,function(e,r){t(e,r)})},addTaskToProject:function(e,t,r){o.findByIdAndUpdate(e,{$push:{tasks:t}},function(e,t){r(e,t)})},removeTaskFromProject:function(e,t,r,s){i.waterfall([function(r){var s={path:"tasks",model:"Task",match:{$or:[{"assignedTo.id":e},{"author.id":e}]}};o.findById(t).populate(s).exec(function(e,t){e?r(e):r(null,t)})},function(e,s){var n=null,i=null;e.tasks&&1==e.tasks.length&&(n=e.tasks[0].author.id,i=e.tasks[0].assignedTo.id),o.findByIdAndUpdate(t,{$pull:{tasks:r}},function(e,t){e?s(e):s(null,t,n,i)})},function(r,s,o,n){!r.author.id.equals(e)&&s&&a(s,t,function(e){e&&n(e)}),o&&a(o,t,function(e){e&&n(e)}),n(null)}],function(e){s(e)})},removeAllProjectTasks:function(e,t){var r={_id:e.tasks};n.remove(r,function(e){t(e)})},deleteProject:function(e,t){e.remove(function(e){t(e)})},addTaskToUser:function(e,t,r){var o={_id:e,"tasks.id":{$ne:t}},n={$addToSet:{tasks:{_id:t}}};s.findOneAndUpdate(o,n,function(e,t){r(e,t)})},removeTaskFromUser:function(e,t,r){var o={$pull:{tasks:t}};s.findByIdAndUpdate(e,o,function(e,t){r(e,t)})},allTasks:function(e,t){"All"!=e?n.find({status:e},function(e,r){t(e,r)}):n.find(function(e,r){t(e,r)})},getTask:function(e,t){n.findById(e,function(e,r){t(e,r)})},createTask:function(e,t){n.create(e,function(e,r){t(e,r)})},deleteTask:function(e,t){e.remove(function(e){t(e)})},getVolunteerTime:function(e,t){n.aggregate([{$match:{status:"Closed","assignedTo.id":e._id}},{$group:{_id:0,total:{$sum:"$volunteerTime"}}}],function(e,r){var s=0;return e||r.length>0&&(s=r[0].total),t(e,s)})},statusQuery:function(e){var t=["Open","In-progress","Pending Approval","Closed"],r=[];if(e)for(var s=0;s<t.length;s++){var o=t[s].toLowerCase();o=o.replace(/ /g,""),e.indexOf(""+o)>-1&&r.push(t[s])}else r=t;return r},categoryQuery:function(e){var t=["Uncategorized","At Home","In-campus","Outdoors"],r=[];if(e)for(var s=0;s<t.length;s++){var o=t[s].toLowerCase();o=o.replace(/ /g,""),e.indexOf(""+o)>-1&&r.push(t[s])}else r=t;return r}}},function(e,t,r){"use strict";"use-strict";var s=r(0);s.promise=r(3);var o={OPEN:"Open",INPROGRESS:"In-progress",PENDING:"Pending Approval",CLOSED:"Closed"},n="Uncategorized",i="At Home",a="In-campus",u="Outdoors",c=s.Schema({name:String,author:{id:{type:s.Schema.Types.ObjectId,ref:"User"},displayName:String},assignedTo:{id:{type:s.Schema.Types.ObjectId,ref:"User"},displayName:String},project:{id:{type:s.Schema.Types.ObjectId,ref:"Project"},name:String},description:String,status:{type:String,enum:[o.OPEN,o.INPROGRESS,o.PENDING,o.CLOSED],default:o.OPEN},category:{type:String,enum:[n,i,a,u],default:n},isFixedTime:{type:Boolean,default:!0},estimatedTime:{type:Number,default:30},volunteerTime:{type:Number,default:0},created:{type:Date,default:Date.now},deadline:{type:Date,default:Date.now},endTime:{type:Date}});c.methods.assignTask=function(e,t){var r=!1;return this.status===o.OPEN&&(this.assignedTo={id:e,displayName:t},this.status=o.ASSIGNED,this.save(),r=!0),r},c.methods.signUp=function(e,t){var r=!1;return this.status===o.OPEN&&(this.assignedTo={id:e,displayName:t},this.status=o.INPROGRESS,this.save(),r=!0),r},c.methods.cancelTask=function(){var e=!1;return this.status===o.INPROGRESS&&(this.assignedTo.id=null,this.assignedTo.displayName="",this.status=o.OPEN,this.save(),e=!0),e},c.methods.completeTask=function(e){var t=!1;return this.status===o.INPROGRESS&&this.assignedTo&&this.assignedTo.id&&this.assignedTo.id.toString()==e.toString()&&(this.status=o.PENDING,this.save(),t=!0),t},c.methods.approveTask=function(){var e=!1;return this.status===o.PENDING&&(this.status=o.CLOSED,this.save(),e=!0),e},c.methods.unapproveTask=function(){var e=!1;return this.status===o.PENDING&&(this.status=o.INPROGRESS,this.save(),e=!0),e},e.exports=s.model("Task",c)},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("passport")},function(e,t,r){"use strict";const s=r(0);e.exports={connect:function(e){s.Promise=r(3);const t=process.env.DATABASEURL||e.db.url;s.connect(t),console.log("Database is connected on: ",t)}}},function(e,t){e.exports=require("passport-local")},function(e,t,r){"use strict";const s=r(12),o=r(14),n=r(8);e.exports.init=function(e,t){t.use(s.initialize()),t.use(s.session()),s.use(new o(n.authenticate())),s.serializeUser(n.serializeUser()),s.deserializeUser(n.deserializeUser())}},function(e,t){e.exports=require("nodemailer-html-to-text")},function(e,t){e.exports=require("nodemailer")},function(e,t,r){"use strict";let s=r(1);e.exports={app:{title:s.name+" [Development mode]"},db:{url:process.env.MONGO_URI||"mongodb://localhost/"+s.config.dbName+"-production"}}},function(e,t,r){"use strict";let s=r(1);e.exports={app:{title:s.name+" [Development mode]"},db:{url:process.env.MONGO_URI||"mongodb://localhost/"+s.config.dbName+"-dev",options:{user:"",pass:"",server:{socketOptions:{keepAlive:1}}}},mailer:{enabled:"true",from:"School Dashboard <sender@example.com>",transporter:"smtp",smtp:{host:"smtp.ethereal.email",port:587,secure:!1,auth:{user:"hllmmt4fhdlbwkwk@ethereal.email",pass:"8s2txRyFJZDEux5grW"}}}}},function(e,t,r){"use strict";let s=r(1);e.exports={app:{title:s.name+" [Test mode]"},hashSecret:"71IIYMzMb0egTaCvvdijhUajAOjsrurzyRX5ziskMk4",sessionSecret:"MB9x-hOkx-UdcCbOprxggu-Wv1PetuoqzBny1h8DULA",test:!0,db:{url:"mongodb://localhost/"+s.config.dbName+"-test",options:{user:"",pass:""}},mailer:{enabled:"true",from:"School Dashboard <sender@example.com>",transporter:"smtp",smtp:{host:"smtp.ethereal.email",port:587,secure:!1,auth:{user:"hllmmt4fhdlbwkwk@ethereal.email",pass:"8s2txRyFJZDEux5grW"}}}}},function(e,t,r){"use strict";let s=r(11),o=r(1);e.exports={app:{title:o.title,version:o.version,description:o.description,url:"http://localhost:"+(process.env.PORT||3e3)+"/",contactEmail:""},ip:process.env.NODE_IP||"0.0.0.0",port:process.env.PORT||3e3,hostname:process.env.PORT||"localhost",rootPath:global.rootPath,dataFolder:s.join(global.rootPath,"data"),viewEngine:"ejs",test:!1,features:{}}},function(e,t){e.exports=require("uuid-token-generator")},function(e,t,r){"use strict";let s=r(22),o=new s(256,s.BASE62);e.exports=function(){return o.generate()}},function(e,t){e.exports=require("lodash")},function(e,t,r){"use strict";"use-strict";var s=r(5),o=r(17),n=r(16).htmlToText;e.exports={init:function(e){o.createTestAccount(function(t,r){return t?(console.error("Failed to create a testing account. "+t.message),process.exit(1)):(console.log("Email credentials obtained ..."),e(t,r))})},send:function(e,t,r,i){var a={from:s.mailer.from,to:e,subject:t,html:r},u=o.createTransport(s.mailer.smtp);if(!u)return i(new Error("Unable to send email! Invalid mailer transport"),null);u.verify(function(e,t){if(e)return console.log("Error verify",e),i(e,null);console.log("success verify"),u.use("compile",n()),u.sendMail(a,function(e,t){return e?(console.log(e),i(e,null)):(console.log(t),i(null,t))})})}}},function(e,t){e.exports=require("crypto")},function(e,t,r){"use strict";var s=r(8),o=r(12),n=r(9),i=r(2),a=r(26),u=r(25),c=r(5);e.exports={getRegister:function(e,t){var r=e.user.userType.toLowerCase();t.render("user/"+r,{title:"Register",currentUser:e.user,page:"register"})},postRegister:function(e,t){var r=new s(e.body.user);r.requiredVolunteerTime*=60,s.register(r,e.body.password,function(r){if(r)return e.flash("error",r.message),void t.redirect("/register");t.redirect("/users")})},getLogin:function(e,t,r){t.render("user/login",{title:"Login"})},postLogin:function(e,t,r){o.authenticate("local",function(s,o){return s?r(s):o?void e.logIn(o,function(e){return e?r(e):t.redirect("/users/"+o._id)}):t.redirect("/login")})(e,t,r)},getLogout:function(e,t){e.logout(),e.flash("success","Successfuly logged out!"),t.redirect("/")},getForgot:function(e,t,r){t.render("user/forgot",{title:"forgot"})},postForgot:function(e,t,r){i.waterfall([function(e){a.randomBytes(20,function(t,r){if(t)return e(t);var s=r.toString("hex");e(null,s)})},function(t,r){s.findOne({email:e.body.email},function(e,s){if(!s)return r(new Error("No account with that email address exists."));s.resetPasswordToken=t,s.resetPasswordExpires=Date.now()+36e5,s.save(function(e){if(e)return r(e);r(null,t,s)})})},function(r,s,o){var n="âœ” Reset your password on "+c.app.title;t.render("mail/passwordReset",{name:s.fullName,resetLink:"http://"+e.headers.host+"/reset/"+r},function(e,t){if(e)return o(e);u.send(s.email,n,t,function(e){o(e||null)})})}],function(r){r?(e.flash("error",r.message),t.redirect("/forgot")):(e.flash("success","An email has been sent to you with further instructions."),t.redirect("/login"))})},getUsers:function(e,t){var r=e.user;n.allUsers(function(s,o){if(s)e.flash("error",s.message),t.redirect("/");else{var n=r.userType.toLowerCase();t.render("user/"+n,{users:o,currentUser:r,page:"index"})}})},getUser:function(e,t){var r=n.statusQuery(e.query.status),s=n.categoryQuery(e.query.category);n.getUserProjects(e.user,r,s,function(o,n){if(o)e.flash("error",o.message),t.redirect("/");else{var i=e.user.userType.toLowerCase();t.render("user/"+i,{user:e.user,projects:n,status:r,category:s,page:"show"})}})},getUserProfile:function(e,t){var r=e.user.userType.toLowerCase();i.waterfall([function(t){s.findById(e.params.id,function(e,r){if(e)return t(e);t(null,r)})},function(e,t){n.getVolunteerTime(e,function(r,s){if(r)return t(r);t(null,e,s)})}],function(s,o,n){s?(e.flash("error",s.message),t.redirect("/users/"+e.params.id)):t.render("user/"+r,{user:o,volunteerTime:n,title:"Profile",page:"profile"})})},getEditUser:function(e,t){var r=e.user.userType.toLowerCase();s.findById(e.params.id,function(s,o){s?(e.flash("error",s.message),t.redirect("/users")):t.render("user/"+r,{title:"Edit User",user:o,page:"edit"})})},putUser:function(e,t){var r=e.body.user;r.requiredVolunteerTime*=60,s.findByIdAndUpdate(e.params.id,r,function(r){r?e.flash("error",r.message):e.flash("success","User is edited successfully!"),t.redirect("/users")})},deleteUser:function(e,t){if(e.user._id.equals(e.params.id)){var r=new Error("You can not delete your own account!");e.flash("error",r.message),t.redirect("/users")}else s.findByIdAndRemove(e.params.id,function(r){r?(e.flash("error",r.message),t.redirect("/users")):(e.flash("success","Successfully deleted the User!"),t.redirect("/users"))})}}},function(e,t,r){"use strict";"use-strict";var s=r(27),o=r(6),n=r(4).Router();n.get("/register",o.isAdmin,s.getRegister),n.post("/register",o.isAdmin,s.postRegister),n.get("/login",s.getLogin),n.post("/login",s.postLogin),n.get("/logout",o.isLoggedIn,s.getLogout),n.get("/forgot",s.getForgot),n.post("/forgot",s.postForgot),n.get("/users",o.isAdmin,s.getUsers),n.get("/users/:id",o.isLoggedIn,s.getUser),n.get("/users/:id/profile",o.isLoggedIn,s.getUserProfile),n.get("/users/:id/edit",o.isAdmin,s.getEditUser),n.put("/users/:id",o.isAdmin,s.putUser),n.delete("/users/:id",o.isAdmin,s.deleteUser),e.exports=n},function(e,t,r){"use strict";var s=r(7),o=r(9),n=r(2);e.exports={getProjects:function(e,t){var r=e.user,s=e.user.userType.toLowerCase(),n=o.statusQuery(e.query.status),i=o.categoryQuery(e.query.category);e.user.isFamily()&&(n="Open"),o.allProjects(e.user,n,i,function(o,a){o?(e.flash("error",o.message),t.redirect("/")):t.render("user/"+s,{user:r,projects:a,status:n,category:i,page:"project/index"})})},getProject:function(e,t){var r=e.user,s=e.user.userType.toLowerCase();o.getProject(e.params.id,function(o,n){o?(e.flash("error",o.message),t.redirect("back")):t.render("user/"+s,{user:r,project:n,page:"project/show"})})},getNewProject:function(e,t){var r=e.user.userType.toLowerCase();t.render("user/"+r,{page:"project/new"})},postNewProject:function(e,t){var r=new s(e.body.project);r.author={id:e.user._id,displayName:e.user.displayName},n.waterfall([function(e){o.createProject(r,function(t,r){return t?e(t):e(null,r)})},function(t,r){o.addProjectToUser(e.user,t._id,function(e){return r(e||null)})}],function(r){if(r)return e.flash("error",r.message),t.redirect("/projects/new");e.flash("success","Successfully created a new Project!"),t.redirect("/users/"+e.user._id)})},getEditProject:function(e,t){var r=e.user.userType.toLowerCase();s.findById(e.params.id,function(s,o){s?(e.flash("error",s.message),t.redirect("back")):t.render("user/"+r,{project:o,page:"project/edit"})})},putProject:function(e,t){s.findByIdAndUpdate(e.params.id,e.body.project,function(r){r?e.flash("error",r.message):e.flash("success","The project is successfully edited!"),t.redirect("/users/"+e.user._id)})},deleteProject:function(e,t){n.waterfall([function(t){s.findById(e.params.id,function(e,r){return e?t(e):t(null,r)})},function(e,t){o.removeProjectFromUser(e.author.id,e._id,function(r){return r?t(r):t(null,e)})},function(e,t){o.removeAllProjectTasks(e,function(r){return r?t(r):t(null,e)})},function(e,t){e.remove(e._id,function(e){return t(e||null)})}],function(r){r?(e.flash("error",r.message),t.redirect("/users/"+e.user._id)):(e.flash("success","Successfully deleted the Project!"),t.redirect("/users/"+e.user._id))})}}},function(e,t,r){"use strict";"use-strict";var s=r(29),o=r(6),n=r(4).Router();n.get("/projects",o.isLoggedIn,s.getProjects),n.get("/projects/new",o.isAdminOrTeacher,s.getNewProject),n.get("/projects/:id",o.isLoggedIn,s.getProject),n.post("/projects",o.isAdminOrTeacher,s.postNewProject),n.get("/projects/:id/edit",o.isProjectOwner,s.getEditProject),n.put("/projects/:id",o.isProjectOwner,s.putProject),n.delete("/projects/:id",o.isProjectOwner,s.deleteProject),e.exports=n},function(e,t){e.exports=require("passport-local-mongoose")},function(e,t,r){"use strict";var s=r(10),o=r(9),n=r(2);e.exports={getTasks:function(e,t){return t.redirect("/projects/"+e.params.id)},getTask:function(e,t){var r=e.user,s=e.user.userType.toLowerCase();o.getTask(e.params.task_id,function(o,n){if(o)return e.flash("error",o.message),t.redirect("back");t.render("user/"+s,{user:r,task:n,page:"task/show"})})},getNewTask:function(e,t){var r=e.user.userType.toLowerCase(),s=e.params.id;t.render("user/"+r,{projectId:s,page:"task/new"})},postNewTask:function(e,t){n.waterfall([function(t){var r=new s(e.body.task);if(r.author={id:e.user._id,displayName:e.user.displayName},e.body.task.estimatedTime=e.body.task.volunteerTime,!r.deadline)return t(new Error("Task deadline/date could not be left empty."));var n="";if(e.body.startTime&&((n=e.body.startTime.split(":"))[0]&&r.deadline.setHours(n[0].trim()),n[1]&&r.deadline.setMinutes(n[1].trim())),e.body.endTime){var i=e.body.endTime;r.endTime=new Date(r.deadline.getTime());var a=i.split(":");a[0]&&r.endTime.setHours(a[0].trim()),a[1]&&r.endTime.setMinutes(a[1].trim())}o.getProject(e.params.id,function(e,s){if(e)return t(e);r.project={id:s._id,name:s.name},t(null,r)})},function(e,t){o.createTask(e,t)},function(e,t){o.addTaskToProject(e.project.id,e._id,function(r,s){if(r)return t(r);t(null,e,s)})},function(t,r,s){o.addTaskToUser(e.user._id,t._id,function(e){if(e)return s(e);s(null,t,r)})},function(t,r,s){o.addProjectToUser(e.user._id,r._id,function(e){if(e)return s(e);s(null)})}],function(r){r?(e.flash("error",r.message),t.redirect("/users/"+e.user._id)):(e.flash("success","The task is created successfully!"),t.redirect("/users/"+e.user._id))})},getEditTask:function(e,t){var r=e.user.userType.toLowerCase();s.findById(e.params.task_id,function(s,o){s?(e.flash("error",s.message),t.redirect("/users/"+e.user._id)):t.render("user/"+r,{task:o,page:"task/edit"})})},putTask:function(e,t){n.waterfall([function(t){if(e.query.Approve||e.query.Complete||(e.body.task.estimatedTime=e.body.task.volunteerTime),e.body.endTime){e.body.task.endTime=new Date(e.body.task.deadline);var r=e.body.endTime.split(":");r[0]&&e.body.task.endTime.setHours(r[0].trim()),r[1]&&e.body.task.endTime.setMinutes(r[1].trim())}s.findByIdAndUpdate(e.params.task_id,e.body.task,function(e,r){if(e)return t(e);t(null,r,"Task is successfully edited!")})},function(t,r,s){if(e.query.Approve){if(!t.approveTask())return s(new Error("The task could not be approved!"));r="The task is successfully approved!"}s(null,t,r)},function(t,r,s){if(e.query.Complete){if(!t.completeTask(e.user._id))return s(new Error("The task could not be changed to completed!"));r="The task is successfully completed!"}s(null,r)}],function(r,s){r?e.flash("error",r.message):e.flash("success",s),t.redirect("/users/"+e.user._id)})},signupTask:function(e,t){n.waterfall([function(t){s.findById(e.params.task_id,function(e,r){if(e)return t(e);t(null,r)})},function(t,r){o.addTaskToUser(e.user._id,t._id,function(e,s){return e?r(e):t.signUp(s._id,s.displayName)?void r(null,t):r(new Error("You can not sign up for this task!"))})},function(t,r){o.addProjectToUser(e.user.id,t.project.id,function(e){if(e)return r(e);r(null)})}],function(r){r?(e.flash("error",r.message),t.redirect("back")):(e.flash("success","You are successfully signed up for the task!"),t.redirect("back"))})},cancelTask:function(e,t){n.waterfall([function(t){o.removeTaskFromUser(e.user._id,e.params.task_id,function(e){if(e)return t(e);t(null)})},function(t){s.findById(e.params.task_id,function(e,r){if(e)return t(e);r.cancelTask(),t(null)})}],function(r){r?(e.flash("error",r.message),t.redirect("back")):(e.flash("success","The Task assign is successfully cancelled!"),t.redirect("back"))})},completeTask:function(e,t){s.findById(e.params.task_id,function(r,s){if(r)return e.flash("error",r.message),t.redirect("back");s.completeTask(e.user._id)?(e.flash("success","The Task status is changed to completed!"),t.redirect("back")):(e.flash("error","The task status could not be changed to completed!"),t.redirect("back"))})},approveTask:function(e,t){s.findById(e.params.task_id,function(r,s){if(r)return e.flash("error",r.message),t.redirect("back");s.approveTask()?(e.flash("success","The task is approved!"),t.redirect("back")):(e.flash("error","The task could not be approved!"),t.redirect("back"))})},postApproveTask:function(e,t){t.redirect("back")},unapproveTask:function(e,t){s.findById(e.params.task_id,function(r,s){if(r)return e.flash("error",r.message),t.redirect("back");s.unapproveTask()?(e.flash("success","The task is unapproved!"),t.redirect("back")):(e.flash("error","The task could not be unapproved!"),t.redirect("back"))})},deleteTask:function(e,t){n.waterfall([function(t){s.findById(e.params.task_id,function(e,r){if(e)return t(e);t(null,r)})},function(e,t){e&&e.author&&o.removeTaskFromUser(e.author.id,e._id,function(r){if(r)return t(r);t(null,e)})},function(e,t){e&&e.assignedTo&&o.removeTaskFromUser(e.assignedTo.id,e._id,function(r){if(r)return t(r);t(null,e)})},function(t,r){t.project&&o.removeTaskFromProject(e.user._id,t.project.id,t._id,function(e){if(e)return r(e);r(null,t)})},function(e,t){e.remove(e._id,function(r){if(r)return t(r);t(null,e)})}],function(r){r?(e.flash("error",r.message),t.redirect("/projects")):(e.flash("success","The task is successfully deleted!"),t.redirect("/projects"))})}}},function(e,t,r){"use strict";"use-strict";var s=r(32),o=r(6),n=r(4).Router();n.get("/projects/:id/tasks",o.isLoggedIn,s.getTasks),n.get("/projects/:id/tasks/new",o.isProjectOwner,s.getNewTask),n.get("/projects/:id/tasks/:task_id",o.isLoggedIn,s.getTask),n.post("/projects/:id/tasks",o.isProjectOwner,s.postNewTask),n.get("/projects/:id/tasks/:task_id/edit",o.isTaskOwner,s.getEditTask),n.put("/projects/:id/tasks/:task_id",o.isLoggedIn,s.putTask),n.get("/projects/:id/tasks/:task_id/signup",o.isFamily,s.signupTask),n.get("/projects/:id/tasks/:task_id/cancel",o.isFamily,s.cancelTask),n.get("/projects/:id/tasks/:task_id/unapprove",o.isTaskOwner,s.unapproveTask),n.delete("/projects/:id/tasks/:task_id",o.isTaskOwner,s.deleteTask),e.exports=n},function(e,t,r){"use strict";e.exports={init:function(e){var t=r(33),s=r(30),o=r(28);e.use("/users",o),e.use("/projects",s),e.use("/projects/:id/tasks",t),e.get("/",function(e,t){t.redirect("/login")}),e.get("*",function(e,t){t.send("Page could not be found!")})}}},function(e,t){e.exports=require("connect-mongo")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("method-override")},function(e,t){e.exports=require("connect-flash")},function(e,t){e.exports=require("body-parser")},function(e,t,r){"use strict";const s=r(4),o=r(39),n=r(38),i=r(37),a=r(11),u=r(36),c=r(0),d=r(35)(u);e.exports=function(){let e,t,l=s();return{create:e=function(e){let t=r(34),f=r(15);l.set("env",e.env),l.set("port",e.port),l.set("hostname",e.hostname),l.use(o.json()),l.use(o.urlencoded({extended:"false"})),l.use(i("_method"));let p=a.normalize(a.join(e.rootPath,"src"));l.set("views",a.join(p,"views")),l.use(s.static(a.join(p,"public"))),l.set("view engine",e.viewEngine),l.use(n()),f.init(e,l),l.use(u({saveUninitialized:!1,resave:!1,secret:e.sessionSecret,store:new d({mongooseConnection:c.connection,autoReconnect:!0})})),l.use(function(e,t,r){t.locals.currentUser=e.user,t.locals.error=e.flash("error"),t.locals.success=e.flash("success"),r()}),t.init(l)},start:t=function(){let e=l.get("hostname"),t=process.env.PORT||l.get("port");l.listen(t,function(){console.log("Express server listening on - http://"+e+":"+t)})},server:l}}},function(e,t,r){"use strict";var s=r(40)(),o=r(13),n=r(5);o.connect(n),s.create(n),s.start(),e.exports=s}]);